<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace :클래스와 동일, 현재 파일의 대표명(test) -->
<mapper namespace="test">
	<!-- 
			select : 조회
			id : 구분자, 메소드명과 동일
			
			resultType : 조회 결과 중 한 줄에 대한 자료 형태를 지정
			Controller 메소드에서 데이터 취득 list로 받을 거라고 지정해뒀음
			쿼리 삽입 시 주의 사항 : ; 이 있는 경우 문제 발생
			 =>  쿼리 실행 시 자동으로 추가 되어  ;;가 됨 
			 
			 xml 파일 수정 시 서버를 껐다 켜줘야 수정 내역이 잘 반영됨
			 (설정파일이라서)
	 -->
	<select id="getSellList" resultType="hashmap">
		SELECT SELL_NO, ITEM_NAME, COUNT, 
			   TO_CHAR(SELL_DT, 'YYYY-MM-DD') AS SELL_DT
		FROM SELL
		ORDER BY SELL_DT DESC, SELL_NO DESC
	</select>
	
	<!-- 
			parameterType : 실행 시 받는 값
			#{키} : 해당위치에 문자열로 키에 해당하는 값을 넣어줌 (따옴표를 자동으로 붙여줌)
					=> 목록에서 열을 클릭했을 때 해당하는 내용이 나오게 할 때 사용 가능
					
			WHERE SELL_NO = #{no}  =>   WHERE SELL_NO = '3' 
			
			#{no} : sellList form태그 이름을 no 로 지정해둠
	 -->
	<select id="getSell" resultType="hashmap" parameterType="hashmap" >
		SELECT SELL_NO, ITEM_NAME, COUNT, 
			   TO_CHAR(SELL_DT, 'YYYY-MM-DD') AS SELL_DT
		FROM SELL
		WHERE SELL_NO = #{no}
	</select>
	
	<!-- 결과값이 돌아오지 않는 애들은 resultType 없고 parameterType 만 있다-->
	<insert id="insertSell" parameterType="hashmap">
		INSERT INTO SELL(SELL_NO, ITEM_NAME, COUNT, SELL_DT)
		VALUES(SELL_SEQ.NEXTVAL, #{itemName}, #{count}, #{sellDt})
	</insert>

	<!-- 결과값이 돌아오지 않는 애들은 resultType 없고 parameterType 만 있다-->
	<delete id="deleteSell" parameterType="hashmap" >
		DELETE FROM SELL
		WHERE SELL_NO = #{no}
	</delete>

	<!-- 결과값이 돌아오지 않는 애들은 resultType 없고 parameterType 만 있다-->
	<update id="updateSell" parameterType="hashmap" >
		UPDATE SELL SET ITEM_NAME = #{itemName},
		COUNT = #{count},
		SELL_DT = #{sellDt}
		WHERE SELL_NO = #{no}	
	</update>




	<!-- MANAGER  -->
	
	<select id="getMgrList" resultType="hashmap" >
		SELECT EMP_NO, NAME, DEPT
		FROM MANAGER
		ORDER BY EMP_NO
	</select>
	
	<select id="getMgr" resultType="hashmap" parameterType="hashmap" >
		SELECT EMP_NO, NAME, DEPT
		FROM MANAGER
		WHERE EMP_NO = #{no}
	</select>
	<insert id="insertMgr" parameterType="hashmap" >
		INSERT INTO MANAGER(EMP_NO, NAME, DEPT)
		VALUES(MGR_SEQ.NEXTVAL, #{empName}, #{deptName})
	</insert>
	<delete id="deleteMgr" parameterType="hashmap" >
		DELETE FROM MANAGER
		WHERE EMP_NO = #{no}
	</delete>
	<update id="updateMgr" parameterType="hashmap" >
		UPDATE MANAGER SET NAME = #{empName},
		DEPT = #{deptName}
		WHERE EMP_NO = #{no}
	</update>
	
	<!-- DIVS -->
	<select id="getDivList" resultType="hashmap" >
		SELECT DIV_CODE, DIV_NAME
		FROM DIVS
	</select>
	
	<select id="getDivDetail" resultType="hashmap" parameterType="hashmap" >
		SELECT DIV_CODE, DIV_NAME
		FROM DIVS
		WHERE DIV_CODE = #{no}
	</select>
	
	<insert id="insertDiv" parameterType="hashmap" >
		INSERT INTO DIVS(DIV_CODE, DIV_NAME)
		VALUES((SELECT #{divCode} || LPAD(NVL(MAX(REPLACE(DIV_CODE, #{divCode}, '')), 0) + 1, 2, 0)
		FROM DIVS
		WHERE DIV_CODE LIKE #{divCode} || '%'), #{divName})
	</insert>
	
	<delete id="deleteDiv" parameterType="hashmap" >
		DELETE FROM DIVS
		WHERE DIV_CODE = #{no}
	</delete>
	
	<update id="updateDiv" parameterType="hashmap">
		UPDATE DIVS SET DIV_NAME = #{divName},
		WHERE DIV_CODE = #{no}
	</update>
	
</mapper>